<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Apache Httpd and Tomcat integration using mod_jk, part 1 | JPrasojo's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="" />
    <meta name="author" content="Lintang JP" />
    <meta name="kittycheck_rumble" content="true" />
    <meta name="kittycheck_position" content="top=60,right=60" />

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/theme/css/font-awesome.css" rel="stylesheet">
    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/img/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/img/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="JPrasojo's Blog ATOM Feed" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">JPrasojo's Blog </a>
          <div class="nav-collapse">
            <ul class="nav">
                <li class="divider-vertical"></li>
                <li class="active">
                  <a href="/category/blog.html">
						        <i class="icon-folder-open icon-large"></i>blog
					         </a>
                </li>
              <ul class="nav pull-right">
                    <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
              </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="span8" id="content">
<div class="row">
    <div class="span2">
        <div class="well">
<footer class="post-info">
<abbr class="published" title="2007-06-03T00:00:00+01:00">
    <i class="icon-calendar"></i>&nbsp;Sun 03 June 2007
</abbr>
<br/><a href="/author/lintang-jp.html"><i class="icon-user"></i>&nbsp;Lintang JP</a>


<br/>
	&nbsp;&nbsp;<a href="/tag/.html" class="label"><i class="icon-tag"></i>&nbsp;</a>
</footer><!-- /.post-info -->        </div>
    </div>
    <div class="span6">
<section id="content" class="well">
    <article>
        <header>
            <h1>
                <a href=""
                        rel="bookmark"
                        title="Permalink to Apache Httpd and Tomcat integration using mod_jk, part 1">
                        Apache Httpd and Tomcat integration using mod_jk, part 1
                </a>
            </h1>
        </header>
        <div class="entry-content">

        <p>In my other blog, I've wrote about howto use mod_jk2 to integrate httpd and tomcat. The article can be accesed <a href="http://www.jroller.com/page/JPrasojo/?anchor=setup_tomcat_clustering_and_load">here</a> and <a href="http://www.jroller.com/page/JPrasojo/?anchor=setup_tomcat_clustering_and_load1">here</a>.
Now, since mod_jk2 has not supported again by apache-tomcat-connector developers, so in this article I will use mod_jk. I'm using :</p>
<ul>
<li>httpd-2.2.4, can be downloaded <a href="http://apache.the.net.id/httpd/httpd-2.2.4.tar.gz">here</a></li>
<li>tomcat-5.2.23, can be downloaded <a href="http://apache.the.net.id/tomcat/tomcat-5/v5.5.23/bin/apache-tomcat-5.5.23.tar.gz">here</a></li>
<li>tomcat-connector, can be downloaded <a href="http://apache.the.net.id/tomcat/tomcat-connectors/jk/binaries/linux/jk-1.2.21/mod_jk-1.2.21-apache-2.2.x-linux-i686.so">here</a></li>
</ul>
<p>I prefer apache.the.net.id since this is the nearest mirror from Indonesia. O ya, Im using Kubuntu Feisty Fawn in my laptop.
First, we install the httpd-2.2.4 first. Unzip it, place it at some directory you like. In my environment, my user has full access to /opt directory, so I'm using it.
onty@phoenix:/opt$ gunzip httpd-2.2.4.tar.gz
onty@phoenix:/opt$ tar -xvf httpd-2.2.4.tar
onty@phoenix:/opt$ mv httpd-2.2.4 httpd-2.2.4-src
onty@phoenix:/opt$ cd httpd-2.2.4-src
Configure, put the result in /opt/httpd-2.2.4, enable shared object, enable cgi support. Enabling shared object makes us able to load dynamic shared object library. We're using mod_jk's shared object, so we need to enable apache to support dynamic shared object library. This also usefull if you want to enable your apache httpd server to serve PHP also. Same like this, you would also compile PHP as shared object, and then load it dynamically to apache httpd using LoadModule syntax in your httpd.conf .
onty@phoenix:/opt/httpd-2.2.4-src$ ./configure --prefix=/opt/httpd-2.2.4 --enable-so --enable-cgi
onty@phoenix:/opt/httpd-2.2.4-src$ make  onty@phoenix:/opt/httpd-2.2.4-src$ make install
Now, try to start it using root :
onty@phoenix:/opt/httpd-2.2.4-src$ cd /opt/httpd-2.2.4
onty@phoenix:/opt/httpd-2.2.4$ su -
root@phoenix:/opt/httpd-2.2.4# bin/apachectl start
If everything ok, you should be able to point your browser to http://localhost now, and see if you can read any "It works" there.
OK, now we continue to install the tomcat connector. Apache has provided us with the binary version of the connector. As mentioned in before, we should now already download it. I'm using mod_jk-1.2.21-apache-2.2.x-linux-i686.so. What we need to do is just load this shared object so that can be used by apache, that simple ? yes :D
Edit your httpd.conf, add this line :
Include conf/extra/mod_jk.conf
This is new style from apache that makes us easier to maintain our configuration file in modular basis.
Now create a new file in conf/extra/ name it mod_jk.conf.
--------------------------------------------- mod_jk.conf -----------------------------------
JkWorkersFile /opt/httpd-2.2.4/conf/workers.properties
JkShmFile /var/log/httpd/mod_jk.shm
JkLogFile /opt/httpd-2.2.4/logs/mod_jk.log
JkLogLevel info
JkLogStampFormat "[%a %b %d %H:%M:%S %Y]"
JkMount /tomcat-docs/* router</p>
<p>JkMount jkstatus
Order deny,allow
Deny from all
Allow from 127.0.0.1</p>
<p>-------------------------------------------------------
From the configuration file, we can see that :
We will place the log file in /opt/httpd-2.2.4/logs/mod_jk.log.
We will configure the connectors with a file named workers.properties located in /opt/httpd-2.2.4/conf .
We will have shared file that will be used by apache and tomcat, located in /var/log/httpd/mod_jk.shm. If the directory /var/log/httpd doesnt exist yet, we should create it first using root user.
The logger level will be INFO.
We will map /tomcat-docs/ request in httpd to be handled by tomcat, so make sure that this webapp exist in tomcat. By default if you download tomcat, this webapp is already exist. Later you can change it to your own webapp. And this request will be handled by a worker named 'router'.
Last one is for jkmanager monitoring tools. There will be new context path named /jkmanager/ that will show us status for our jk_module. This context path only allowed to be accessed from 127.0.0.1 (localhost).</p>
<p>Ok, now we need to create workers.properties in conf/ directory. See part 2 of this post.</p>
        </div><!-- /.entry-content -->
    </article>
</section>
</div>
</div>
        </div><!--/span-->
        <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><div><i class="icon-external-link"></i><a href="http://getpelican.com/">Pelican</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="http://python.org/">Python.org</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="http://jinja.pocoo.org/">Jinja2</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="#">You can modify those links in your config file</a></div></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="/" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="#"><i class="icon-You can add links in your config file-sign icon-large"></i>You can add links in your config file</a></li>
    <li><a href="#"><i class="icon-Another social link-sign icon-large"></i>Another social link</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/blog.html">
    <i class="icon-folder-open icon-large"></i>blog
</a>
</li>

<li class="nav-header"><a href="/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
    <li class="tag-4">
        <a href="/tag/linux-stuff.html">
            <i class="icon-tag icon-large"></i>Linux stuff
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/telco-billing-cdma-450-3g.html">
            <i class="icon-tag icon-large"></i>Telco Billing CDMA 450 3G
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/travel.html">
            <i class="icon-tag icon-large"></i>Travel
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/ruby-dsl-linux-stuff.html">
            <i class="icon-tag icon-large"></i>Ruby DSL Linux stuff
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/tips-unix-linux-stuff.html">
            <i class="icon-tag icon-large"></i>Tips Unix Linux stuff
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/jumpstart-unix-linux-stuff-solaris.html">
            <i class="icon-tag icon-large"></i>jumpstart Unix Linux stuff solaris
        </a>
    </li>
    <li class="tag-3">
        <a href="/tag/telco-billing.html">
            <i class="icon-tag icon-large"></i>Telco Billing
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/broadband-at-home-internet-3g.html">
            <i class="icon-tag icon-large"></i>Broadband at home Internet 3G
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/cms.html">
            <i class="icon-tag icon-large"></i>CMS
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/wordpress-verify-google-webmaster-internet.html">
            <i class="icon-tag icon-large"></i>wordpress verify google webmaster Internet
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/os-linux-stuff-opensolaris-solaris.html">
            <i class="icon-tag icon-large"></i>OS Linux stuff OpenSolaris solaris
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/tips-unix-linux-stuff-web-server-nginx.html">
            <i class="icon-tag icon-large"></i>Tips Unix Linux stuff Web Server Nginx
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/laptop.html">
            <i class="icon-tag icon-large"></i>Laptop
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/renungan.html">
            <i class="icon-tag icon-large"></i>Renungan
        </a>
    </li>
    <li class="tag-1">
        <a href="/tag/.html">
            <i class="icon-tag icon-large"></i>
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/tips.html">
            <i class="icon-tag icon-large"></i>Tips
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/atutor-unix-linux-stuff-web-server-internet-nginx.html">
            <i class="icon-tag icon-large"></i>aTutor Unix Linux stuff Web Server Internet Nginx
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/family.html">
            <i class="icon-tag icon-large"></i>Family
        </a>
    </li>
    <li class="tag-4">
        <a href="/tag/interconnect-telekomunikasi-telco-billing-interkoneksi.html">
            <i class="icon-tag icon-large"></i>Interconnect Telekomunikasi Telco Billing Interkoneksi
        </a>
    </li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

    </div><!--/.fluid-container-->


    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>