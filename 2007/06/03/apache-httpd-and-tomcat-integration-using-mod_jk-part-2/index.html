<!doctype html>
<html lang="en">

<head>

    <title>Apache Httpd and Tomcat integration using mod_jk, part 2 - JPrasojo's blog</title>

    <!-- meta -->
    <meta charset="utf-8" />
    <meta name="author" content="Lintang JP" />
    <meta name="dc.language" content="en" />
    <meta name="dc.license" content="">

    <!-- favicon -->
    <link rel="icon" href="http://blog.theprasojos.web.id/theme/favicon.ico" type="image/x-icon">

    <!-- newsfeeds -->
        <link href="http://blog.theprasojos.web.id/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="JPrasojo's blog Full Atom Feed" />
        <link href="http://blog.theprasojos.web.id/feeds/unixlinux.atom.xml" type="application/atom+xml" rel="alternate" title="JPrasojo's blog Categories Atom Feed" />

    <!-- assets -->
    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
   
    <link href="https://fonts.googleapis.com/css?family=Linden+Hill:400,400italic" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Anonymous+Pro' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://blog.theprasojos.web.id/theme/css/simplegrid.css" type="text/css">
    <link rel="stylesheet" href="http://blog.theprasojos.web.id/theme/css/main.css" type="text/css">
    <link rel="stylesheet" href="http://blog.theprasojos.web.id/theme/css/pygments.css" type="text/css">
    <!--[if lt IE 8]>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet" type="text/css">
    <![endif]-->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" type="text/css">

</head>

<body>

   <div class="grid grid-pad">
     <div class="col-1-1">        
       <ul id="mainnav">
          <li><a href="http://blog.theprasojos.web.id">home</a></li>
          <li><a href="http://blog.theprasojos.web.id/pages/hello-world.html">About</a></li>
       </ul>
       <div id="blogtitle"><a href="http://blog.theprasojos.web.id">JPrasojo's blog</a></div>
       <div id="blogsubtitle"><a href="http://blog.theprasojos.web.id"></a></div>
     </div>
    </div>

    <div class="grid grid-pad">
       <div id="left-side" class="col-8-12">
          <section id="content" class="hyphenate">

    <h1 class="title">Apache Httpd and Tomcat integration using mod_jk, part 2</h1>

        <div class="date">
            <p>written on Sun 03 June 2007
            by <a rel="author" href="http://blog.theprasojos.web.id/pages/aboutme.html">Lintang JP</a></p>
        </div>

    <div class="clearboth"><p>This posting splitted because somehow blogspot just cut it. I don't know why but when I previewed the posting, blogspot just cut the postings, so I splitted it into 2 parts.</p>
<p>Ok, now we create workers.properties file.</p>
<div class="highlight"><pre>onty@phoenix:/opt/httpd-2.2.4$ vi conf/workers.properties
\------------------------------------------------------------------------------------
worker.list=router,jkstatus
# Define a worker using ajp13
worker.worker1.port=8009
worker.worker1.host=localhost
worker.worker1.type=ajp13
worker.worker1.lbfactor=1
# Define prefered failover node for worker1
worker.worker1.redirect=worker2
# Define another worker using ajp13
worker.worker2.port=8009
worker.worker2.host=localhost
worker.worker2.type=ajp13
worker.worker2.lbfactor=1

# Define the LB worker
worker.router.type=lb
worker.router.balance_workers=worker1,worker2
# Define the status worker
worker.jkstatus.type=status

\------------------------------------------------------------------------------------
</pre></div>


<p>This file defines all our workers. Our 'router' worker will be a load balancer worker for other workers, including worker1 and worker2.</p>
<p>Now, we install (unzip, exactly) our apache. We use apache-5.2.23. We will modify the directory structure little bit, as shown like this.</p>
<p><img alt="" src="http://bp0.blogger.com/_02IFrF9Xz98/RmKTVamjjKI/AAAAAAAABkI/CptR2eLPrpA/s320/opt-structure.png" />
Give attention to tomcat1 and tomcat2 directory, and also directories inside it.We will use 2 instance of tomcat1 and tomcat2 as worker 'worker1' and 'worker2'. We also need to configure each server.xml in tomcat1 and tomcat2 so that they're not using the same port.</p>
<div class="highlight"><pre><span class="n">Tomcat1</span> <span class="o">:</span>
<span class="n">Server</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;8005&quot;</span> <span class="n">shutdown</span><span class="o">=</span><span class="s2">&quot;SHUTDOWN&quot;</span>
<span class="o">..</span>
<span class="o">..</span>
<span class="n">Connector</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;8009&quot;</span>
<span class="n">enableLookups</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="n">redirectPort</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span> <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;AJP/1.3&quot;</span>
<span class="o">..</span>
<span class="o">..</span>

<span class="n">Connector</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;8080&quot;</span> <span class="n">maxHttpHeaderSize</span><span class="o">=</span><span class="s2">&quot;8192&quot;</span>
<span class="n">maxThreads</span><span class="o">=</span><span class="s2">&quot;150&quot;</span> <span class="n">minSpareThreads</span><span class="o">=</span><span class="s2">&quot;25&quot;</span> <span class="n">maxSpareThreads</span><span class="o">=</span><span class="s2">&quot;75&quot;</span>
<span class="n">enableLookups</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="n">redirectPort</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span> <span class="n">acceptCount</span><span class="o">=</span><span class="s2">&quot;100&quot;</span>
<span class="n">connectionTimeout</span><span class="o">=</span><span class="s2">&quot;20000&quot;</span> <span class="n">disableUploadTimeout</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>

<span class="n">Tomcat2</span> <span class="o">:</span>
<span class="n">Server</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;9005&quot;</span> <span class="n">shutdown</span><span class="o">=</span><span class="s2">&quot;SHUTDOWN&quot;</span>
<span class="o">..</span>
<span class="o">..</span>
<span class="n">Connector</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;9009&quot;</span>
<span class="n">enableLookups</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="n">redirectPort</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span> <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;AJP/1.3&quot;</span>
<span class="o">..</span>
<span class="o">..</span>

<span class="n">Connector</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;8080&quot;</span> <span class="n">maxHttpHeaderSize</span><span class="o">=</span><span class="s2">&quot;8192&quot;</span>
<span class="n">maxThreads</span><span class="o">=</span><span class="s2">&quot;150&quot;</span> <span class="n">minSpareThreads</span><span class="o">=</span><span class="s2">&quot;25&quot;</span> <span class="n">maxSpareThreads</span><span class="o">=</span><span class="s2">&quot;75&quot;</span>
<span class="n">enableLookups</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="n">redirectPort</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span> <span class="n">acceptCount</span><span class="o">=</span><span class="s2">&quot;100&quot;</span>
<span class="n">connectionTimeout</span><span class="o">=</span><span class="s2">&quot;20000&quot;</span> <span class="n">disableUploadTimeout</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
</pre></div>


<p>One more thing, we need to create startup and shutdown file for each tomcat instance. We call it start1.sh, start2.sh, stop1.sh, stop2.sh</p>
<div class="highlight"><pre>start1.sh
#!/bin/bash
export CATALINA_BASE=/opt/apache-tomcat-5.5.23-cluster/tomcat1
export JAVA_HOME=/opt/jdk1.6.0
./startup.sh
start2.sh
#!/bin/bash
export CATALINA_BASE=/opt/apache-tomcat-5.5.23-cluster/tomcat2
export JAVA_HOME=/opt/jdk1.6.0
./startup.sh
stop1.sh
#!/bin/bash
export CATALINA_BASE=/opt/apache-tomcat-5.5.23-cluster/tomcat1
export JAVA_HOME=/opt/jdk1.6.0
./shutdown.sh
stop2.sh
#!/bin/bash
export CATALINA_BASE=/opt/apache-tomcat-5.5.23-cluster/tomcat2
export JAVA_HOME=/opt/jdk1.6.0
./shutdown.sh
</pre></div>


<p>Basically, these file just aimed to setup environment variable named CATALINA_BASE to point which tomcat instance we want to start/stop.</p>
<p>Now, lets try our installation. Start both tomcat instance, and also start your httpd server. Point out the browser to http://localhost/tomcat-docs/ and see if the request handled correctly. Httpd will redirect the request so that can be served by tomcat. Also point the browser to http://localhost/jkmanager/. This context path shows us the Load Balancing status for our tomcat instance.</p>
<p>Feel free to drop any comments about this posting.
Thanks, good luck trying !</p></div>

        <div class="tags">
            <p>This entry was tagged on  
                <a href="http://blog.theprasojos.web.id/tag/.html">#</a></p>
        </div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = "jprasojos";
    var disqus_title = "Apache Httpd and Tomcat integration using mod_jk, part 2";
    var disqus_url = "http://blog.theprasojos.web.id/2007/06/03/apache-httpd-and-tomcat-integration-using-mod_jk-part-2/";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </section>
       </div>

       <div id="right-side" class="col-1-12">&nbsp;</div>
       <div id="right-side" class="col-3-12">

<div class="section-container">
   <h3>Blogroll</h3>
   <ul>
      <li><a href="http://getpelican.com/" target="_blank">Pelican <i class="fa fa-globe fa-fw"></i></a></li>
      <li><a href="http://python.org/" target="_blank">Python.org <i class="fa fa-globe fa-fw"></i></a></li>
      <li><a href="https://vhynaulia.wordpress.com/" target="_blank">Blognya TePot <i class="fa fa-globe fa-fw"></i></a></li>
      <li><a href="http://theprasojos.wordpress.com" target="_blank">Theprasojos Family <i class="fa fa-globe fa-fw"></i></a></li>
   </ul>
</div>

<div class="section-container">
   <h3>Social Network</h3>
   <ul>
      <li>
        <a href="https://twitter.com/jprasojo" target="_blank">Twitter&nbsp;
           <i class="fa fa-twitter fa-fw"></i>
        </a>
      </li>
      <li>
        <a href="https://www.linkedin.com/in/lintangprasojo" target="_blank">Linkedin&nbsp;
           <i class="fa fa-linkedin fa-fw"></i>
        </a>
      </li>
   </ul>
</div>

<div class="section-container">
   <h3>Categories</h3>
   <ul>
        <li><a href="http://blog.theprasojos.web.id/category/family.html">Family <i class="fa fa-folder-open fa-fw"></i></a></li>
        <li><a href="http://blog.theprasojos.web.id/category/java.html">Java <i class="fa fa-folder-open fa-fw"></i></a></li>
        <li><a href="http://blog.theprasojos.web.id/category/renungan.html">Renungan <i class="fa fa-folder-open fa-fw"></i></a></li>
        <li><a href="http://blog.theprasojos.web.id/category/telco.html">Telco <i class="fa fa-folder-open fa-fw"></i></a></li>
        <li><a href="http://blog.theprasojos.web.id/category/travelling.html">Travelling <i class="fa fa-folder-open fa-fw"></i></a></li>
        <li><a href="http://blog.theprasojos.web.id/category/unixlinux.html">Unix/Linux <i class="fa fa-folder-open fa-fw"></i></a></li>
   </ul>
</div>

<div class="section-container">
   <h3>Tags</h3>
   <ul class="tagcloud">
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/lembur-kuring-medan.html">#lembur_kuring_medan</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/ruby-dsl-linux-stuff.html">#Ruby_DSL_Linux_stuff</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/cms.html">#CMS</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/indonesian-embassy.html">#indonesian_embassy</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/wordpress-verify-google-webmaster-internet.html">#wordpress_verify_google_webmaster_Internet</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/tips-unix-linux-stuff-web-server-nginx.html">#Tips_Unix_Linux_stuff_Web_Server_Nginx</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/telco-billing-cdma-450-3g.html">#Telco_Billing_CDMA_450_3G</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/martebe.html">#martebe</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/tips-unix-linux-stuff.html">#Tips_Unix_Linux_stuff</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/tips.html">#Tips</a></li>
        <li class="tag-3"><a href="http://blog.theprasojos.web.id/tag/telco-billing.html">#Telco_Billing</a></li>
        <li class="tag-3"><a href="http://blog.theprasojos.web.id/tag/renungan.html">#Renungan</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/grand-angkasa.html">#grand_angkasa</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/os-linux-stuff-opensolaris-solaris.html">#OS_Linux_stuff_OpenSolaris_solaris</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/medan.html">#medan</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/intelligent-network.html">#Intelligent_Network</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/tiara-medan.html">#tiara_medan</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/family.html">#Family</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/travel.html">#Travel</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/ocs.html">#OCS</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/broadband-at-home-internet-3g.html">#Broadband_at_home_Internet_3G</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/merdeka-walk.html">#merdeka_walk</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/visa.html">#VISA</a></li>
        <li class="tag-1"><a href="http://blog.theprasojos.web.id/tag/.html">#</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/charging-system.html">#Charging_System</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/harare.html">#harare</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/laptop.html">#Laptop</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/zimbabwe.html">#zimbabwe</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/jumpstart-unix-linux-stuff-solaris.html">#jumpstart_Unix_Linux_stuff_solaris</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/green-card.html">#Green_Card</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/grand-angkasa-medan.html">#grand_angkasa_medan</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/atutor-unix-linux-stuff-web-server-internet-nginx.html">#aTutor_Unix_Linux_stuff_Web_Server_Internet_Nginx</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/embassy.html">#embassy</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/linux-stuff.html">#Linux_stuff</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/interconnect-telekomunikasi-telco-billing-interkoneksi.html">#Interconnect_Telekomunikasi_Telco_Billing_Interkoneksi</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/ireland.html">#Ireland</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/brastagi.html">#brastagi</a></li>
        <li class="tag-4"><a href="http://blog.theprasojos.web.id/tag/prepaid-system.html">#Prepaid_System</a></li>
   </ul>
</div>

<div class="section-container">
   <h3>Feeds</h3>
   <ul>
      <li><a href="http://blog.theprasojos.web.id/feeds/all.atom.xml" rel="alternate">atom feed <i class="fa fa-rss fa-fw"></i></a></li>
   </ul>
</div>

<div class="section-container">
   <h3>Archives</h3>
   <ul>
      <li><a href="http://blog.theprasojos.web.id/archives.html">All Archives</a></li>
    
            <li><a href="http://blog.theprasojos.web.id/posts/2014/11/index.html">November 2014</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2014/10/index.html">October 2014</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2014/08/index.html">August 2014</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2014/07/index.html">July 2014</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2014/03/index.html">March 2014</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2011/02/index.html">February 2011</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2010/08/index.html">August 2010</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2010/04/index.html">April 2010</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2009/12/index.html">December 2009</a></li>
      

      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2009/05/index.html">May 2009</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2009/01/index.html">January 2009</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2008/12/index.html">December 2008</a></li>
      

      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2008/06/index.html">June 2008</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2008/03/index.html">March 2008</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2008/01/index.html">January 2008</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2007/12/index.html">December 2007</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2007/11/index.html">November 2007</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2007/08/index.html">August 2007</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2007/06/index.html">June 2007</a></li>
      

      

      

      

      

      

      

      

      

      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2007/05/index.html">May 2007</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2007/04/index.html">April 2007</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2006/04/index.html">April 2006</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2005/07/index.html">July 2005</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2005/06/index.html">June 2005</a></li>
      

      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2005/04/index.html">April 2005</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2005/03/index.html">March 2005</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2004/11/index.html">November 2004</a></li>
      

            <li><a href="http://blog.theprasojos.web.id/posts/2004/10/index.html">October 2004</a></li>
      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2004/09/index.html">September 2004</a></li>
      

      

      

      

            <li><a href="http://blog.theprasojos.web.id/posts/2004/08/index.html">August 2004</a></li>
      

   </ul>
</div>

          <div class="section-container" id="copyright">
             <p>This Blog generated by <a href="http://getpelican.com/">Pelican</a> using <a href="https://github.com/habibillah/pujangga">Pujangga</a> theme. All content on this blog, unless stated otherwise, is licensed under the <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 International license</a>.</p>
          </div>
       </div>
    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-56589451-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
 

    <script type="text/javascript" src="http://blog.theprasojos.web.id/theme/js/hyphenator.js"></script>
    <script type="text/javascript">
      Hyphenator.config({
          donthyphenateclassname: 'docutils',
          useCSS3hyphenation: true
      });
      Hyphenator.run();
    </script>

</body>

</html>